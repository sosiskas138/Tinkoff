{
  "figi": "BBG004730N88",
  "params": {
    "kama_len": 21,
    "kama_fast": 2,
    "kama_slow": 20,
    "entry_mult": 1.6,
    "exit_mult": 0.8,
    "atr_len": 14,
    "atr_sl_mult": 2.2,
    "atr_phase_len": 50,
    "atr_phase_mult": 1.0,
    "body_atr_mult": 0.5,
    "fitness_score": 0.0,
    "total_profit_pct": 0.0,
    "sharpe_ratio": 0.0,
    "max_drawdown_pct": 0.0,
    "win_rate": 0.0,
    "total_trades": 0
  },
  "last_retrain_date": "2026-01-03T16:45:45.558675",
  "retrain_period_days": 30,
  "pinescript_code": "// *************************************************************************************************************************************************************************************************************************************************************************\n// Acrypto - Weigthed Strategy v1.4.9\n// Github: https://github.com/AlbertoCuadra/algo_trading_weighted_strategy\n//\n//\n// You can support the project on https://www.buymeacoffee.com/acuadra\n//\n// License: Â© accry - This work is licensed under a Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License\n//                    https://creativecommons.org/licenses/by-nc-sa/4.0/\n//\n// Last update: 24/04/2022\n// *************************************************************************************************************************************************************************************************************************************************************************\n//@version=5\nstrategy(title='Acrypto - Weighted Strategy v1.4.9', overlay=true, precision=2, commission_value=0.075, commission_type=strategy.commission.percent, initial_capital=1000, currency=currency.USD, default_qty_type=strategy.percent_of_equity, default_qty_value=100, slippage=1)\n// *************************************************************************************************************************************************************************************************************************************************************************\n// COMMENTS\n// *************************************************************************************************************************************************************************************************************************************************************************\n \n\n// *************************************************************************************************************************************************************************************************************************************************************************\n// INPUTS\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * Type trading\nallow_longs = input.bool(true, 'Allow Longs', group='Trading type')\nallow_shorts = input.bool(true, 'Allow Shorts', group='Trading type')\n// * Datastamp\nfrom_day = input.int(1, 'From Day', minval=1, maxval=31, group='DataStamp')\nfrom_month = input.int(1, 'From Month', minval=1, maxval=12, group='DataStamp')\nfrom_year = input.int(2021, 'From Year', minval=1980, maxval=9999, group='DataStamp')\nto_day = input.int(1, 'To Day', minval=1, maxval=31, group='DataStamp')\nto_month = input.int(1, 'To Month', minval=1, maxval=12, group='DataStamp')\nto_year = input.int(9999, 'To Year', minval=2017, maxval=9999, group='DataStamp')\n// * Stop loss\nstoploss = input.bool(true, 'Stop loss', group='Stop loss')\nmovestoploss = input.string('TP-2', 'Move stop loss', options=['None', 'Percentage', 'TP-1', 'TP-2', 'TP-3'], group='Stop loss')\nmovestoploss_entry = input.bool(false, 'Move stop loss to entry', group='Stop loss')\nstoploss_perc = input.float(6.0, 'Stop Loss %', minval=0, maxval=100, group='Stop loss') * 0.01\nmove_stoploss_factor = input.float(20.0, 'Move stop loss factor %', group='Stop loss') * 0.01 + 1\nstop_source = input.source(hl2, 'Stop Source', group='Stop loss')\n// * Take profits\ntake_profits = input.bool(true, 'Take profits', group='Take Profits')\n// retrade= input.bool(false, 'Retrade', group='Take Profits')\nMAX_TP = input.int(6, 'Max number of TP', minval=1, maxval=6, group='Take Profits')\nlong_profit_perc = input.float(6.8, 'Long - take profits each x (%)', minval=0.0, maxval=999, step=1, group='Take Profits') * 0.01\nlong_profit_qty = input.float(15, 'Long - take x (%) from open position', minval=0.0, maxval=100, step=1, group='Take Profits')\nshort_profit_perc = input.float(13, 'Short - take profits each x (%)', minval=0.0, maxval=999, step=1, group='Take Profits') * 0.01\nshort_profit_qty = input.float(10, 'Short - take x (%) from open position', minval=0.0, maxval=100, step=1, group='Take Profits')\n// * Delays\ndelay_macd = input.int(1, 'Candles delay MACD', minval=1, group='Delays')\ndelay_srsi = input.int(2, 'Candles delay Stoch RSI', minval=1, group='Delays')\ndelay_rsi = input.int(2, 'Candles delay RSI', minval=1, group='Delays')\ndelay_super = input.int(1, 'Candles delay Supertrend', minval=1, group='Delays')\ndelay_cross = input.int(1, 'Candles delay MA cross', minval=1, group='Delays')\ndelay_exit = input.int(7, 'Candles delay exit', minval=1, group='Delays')\n// * Inputs Weigthed strategies\nstr_0 = input.bool(true, 'Strategy 0: Weighted Strategy', group='Weights')\nweight_trigger = input.int(2, 'Weight Signal entry [0, 5]', minval=0, maxval=5, step=1, group='Weights')\nweight_str1 = input.int(1, 'Weight Strategy 1 [0, 5]', minval=0, maxval=5, step=1, group='Weights')\nweight_str2 = input.int(1, 'Weight Strategy 2 [0, 5]', minval=0, maxval=5, step=1, group='Weights')\nweight_str3 = input.int(1, 'Weight Strategy 3 [0, 5]', minval=0, maxval=5, step=1, group='Weights')\nweight_str4 = input.int(1, 'Weight Strategy 4 [0, 5]', minval=0, maxval=5, step=1, group='Weights')\nweight_str5 = input.int(1, 'Weight Strategy 5 [0, 5]', minval=0, maxval=5, step=1, group='Weights')\n// * Inputs strategy 1: MACD \nstr_1 = input.bool(true, 'Strategy 1: MACD', group='Strategy 1: MACD')\nMA1_period_1 = input.int(16, 'MA 1', minval=1, maxval=9999, step=1, group='Strategy 1: MACD')\nMA1_type_1 = input.string('EMA', 'MA1 Type', options=['RMA', 'SMA', 'EMA', 'WMA', 'HMA', 'DEMA', 'TEMA', 'VWMA'], group='Strategy 1: MACD')\nMA1_source_1 = input.source(hl2, 'MA1 Source', group='Strategy 1: MACD')\nMA2_period_1 = input.int(36, 'MA 2', minval=1, maxval=9999, step=1, group='Strategy 1: MACD')\nMA2_type_1 = input.string('EMA', 'MA2 Type', options=['RMA', 'SMA', 'EMA', 'WMA', 'HMA', 'DEMA', 'TEMA', 'VWMA'], group='Strategy 1: MACD')\nMA2_source_1 = input.source(high, 'MA2 Source', group='Strategy 1: MACD')\n// * Inputs strategy 2: Stoch RSI oversold/overbought\nstr_2 = input.bool(true, 'Strategy 2: Stoch RSI', group='Strategy 2: Stoch RSI')\nlong_RSI = input.float(70, 'Exit SRSI Long (%)', minval=0.0, step=1, group='Strategy 2: Stoch RSI')\nshort_RSI = input.float(27, 'Exit SRSI Short (%)', minval=0.0, step=1, group='Strategy 2: Stoch RSI')\nlength_RSI = input.int(14, 'RSI Length', group='Strategy 2: Stoch RSI')\nlength_stoch = input.int(14, 'RSI Stochastic', group='Strategy 2: Stoch RSI')\nsmoothK = input.int(3, 'Smooth k', group='Strategy 2: Stoch RSI')\n// * Inputs strategy 3: RSI oversold/overbought\nstr_3 = input.bool(true, 'Strategy 3: RSI', group='Strategy 3: RSI')\nlong_RSI2 = input.float(77, 'Exit RSI Long (%)', minval=0.0, step=1, group='Strategy 3: RSI')\nshort_RSI2 = input.float(30, 'Exit RSI Short (%)', minval=0.0, step=1, group='Strategy 3: RSI')\n// * Inputs strategy 4: Supertrend\nstr_4 = input.bool(true, 'Strategy 4: Supertrend', group='Strategy 4: Supertrend')\nperiods_4 = input.int(2, 'ATR Period', group='Strategy 4: Supertrend')\nsource_4 = input.source(hl2, 'Source', group='Strategy 4: Supertrend')\nmultiplier = input.float(2.4, 'ATR Multiplier', step=0.1, group='Strategy 4: Supertrend')\nchange_ATR = input.bool(true, 'Change ATR Calculation Method ?', group='Strategy 4: Supertrend')\n// * Inputs strategy 5: MA CROSS\nstr_5 = input.bool(true, 'Strategy 5: MA CROSS', group='Strategy 5: MA CROSS')\nMA1_period_5 = input.int(46, 'MA 1', minval=1, maxval=9999, step=1, group='Strategy 5: MA CROSS')\nMA1_type_5 = input.string('EMA', 'MA1 Type', options=['RMA', 'SMA', 'EMA', 'WMA', 'HMA', 'DEMA', 'TEMA', 'VWMA'], group='Strategy 5: MA CROSS')\nMA1_source_5 = input.source(close, 'MA1 Source', group='Strategy 5: MA CROSS')\nMA2_period_5 = input.int(82, 'MA 2', minval=1, maxval=9999, step=1, group='Strategy 5: MA CROSS')\nMA2_type_5 = input.string('EMA', 'MA2 Type', options=['RMA', 'SMA', 'EMA', 'WMA', 'HMA', 'DEMA', 'TEMA', 'VWMA'], group='Strategy 5: MA CROSS')\nMA2_source_5 = input.source(close, 'MA2 Source', group='Strategy 5: MA CROSS')\n// * Inputs Potential TOP/BOTTOM\nstr_6 = input.bool(false, 'Close order at potential Top/Bottom', group='Potential TOP/BOTTOM')\ntop_qty = input.float(30, 'Top - take x (%) from the remaining position', minval=0.0, maxval=100, step=1, group='Potential TOP/BOTTOM')\nbottom_qty = input.float(30, 'Bottom - take x (%) from the remaining position', minval=0.0, maxval=100, step=1, group='Potential TOP/BOTTOM') \nsource_6_top = input.source(close, 'TP-TOP at previous?', group='Potential TOP/BOTTOM')\nsource_6_bottom = input.source(close, 'TP-BOTTOM at previous?', group='Potential TOP/BOTTOM')\nlong_trail_perc = input.float(150, 'Trail volume Long (%)', minval=0.0, step=1, group='Potential TOP/BOTTOM') * 0.01\nshort_trail_perc = input.float(150, 'Trail volume Short (%)', minval=0.0, step=1, group='Potential TOP/BOTTOM') * 0.01\n// * Miscellaneous\nFLAG_SIGNALS = input.bool(true, 'Show Buy/Sell Signals ?', group='Miscellaneous')\nFLAG_SHADOWS = input.bool(true, 'Show shadows satisfied strategies ?', group='Miscellaneous')\nFLAG_ONEPAIR = input.bool(false, 'Analyze only one pair asset ?', group='Miscellaneous')\npair_asset = input.string('BINANCE:BTCUSDT', 'Pair asset to analyze', group='Miscellaneous')\n// * Alarms\nalarm_label_long = input.string('Buy', 'Label open long', group='Basic alarm system')\nalarm_label_short = input.string('Sell', 'Label open short', group='Basic alarm system')\nalarm_label_close_long = input.string('Close long', 'Label close long', group='Basic alarm system')\nalarm_label_close_short = input.string('Close short', 'Label close short', group='Basic alarm system')\nalarm_label_TP_long = input.string('TP long', 'Label Take Profit long', group='Basic alarm system')\nalarm_label_TP_short = input.string('TP short', 'Label Take Profit short', group='Basic alarm system')\nalarm_label_SL = input.string('SL', 'Label Stop-Loss', group='Basic alarm system')\n// *************************************************************************************************************************************************************************************************************************************************************************\n// ABBREVIATIONS\n// *************************************************************************************************************************************************************************************************************************************************************************\n// TP: Take profits\n// SL: Stop-Loss\n// *************************************************************************************************************************************************************************************************************************************************************************\n// GLOBAL VARIABLES\n// *************************************************************************************************************************************************************************************************************************************************************************\nstart = timestamp(from_year, from_month, from_day, 00, 00) // backtest start window\nend = timestamp(to_year, to_month, to_day, 23, 59)// backtest finish window\nvar FLAG_FIRST = false\nvar price_stop_long = 0.\nvar price_stop_short = 0.\nvar profit_qty = 0. // Quantity to close per TP from open position\nvar profit_perc = 0. // Percentage to take profits since open position or last TP\nvar nextTP = 0. // Next target to take profits\nvar since_entry = 0 // Number of bars since open last postion\nvar since_close = 0 // Number of bars since close or TP/STOP last position\nvar pair_asset_prime = syminfo.tickerid // Actual pair asset\nvar FLAG_VISIBLE = true\n// * Check FLAG analyze only one pair asset\nif FLAG_ONEPAIR \n    FLAG_VISIBLE := pair_asset == pair_asset_prime\nelse\n    FLAG_VISIBLE := true\n// * Compute profit quantity and profit percentage\nif strategy.position_size > 0\n    profit_qty := long_profit_qty\n    profit_perc := long_profit_perc\nelse if strategy.position_size < 0\n    profit_qty := short_profit_qty\n    profit_perc := short_profit_perc\nelse\n    nextTP := 0. // Next Take Profit target (out of market)\n// *************************************************************************************************************************************************************************************************************************************************************************\n// FUNCTIONS\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * MA type\n// *************************************************************************************************************************************************************************************************************************************************************************\nma(MAType, MASource, MAPeriod) =>\n    if MAType == 'SMA'\n        ta.sma(MASource, MAPeriod)\n    else if MAType == 'EMA'\n        ta.ema(MASource, MAPeriod)\n    else if MAType == 'WMA'\n        ta.wma(MASource, MAPeriod)\n    else if MAType == 'RMA'\n        ta.rma(MASource, MAPeriod)\n    else if MAType == 'HMA'\n        ta.wma(2 * ta.wma(MASource, MAPeriod / 2) - ta.wma(MASource, MAPeriod), math.round(math.sqrt(MAPeriod)))\n    else if MAType == 'DEMA'\n        e = ta.ema(MASource, MAPeriod)\n        2 * e - ta.ema(e, MAPeriod)\n    else if MAType == 'TEMA'\n        e = ta.ema(MASource, MAPeriod)\n        3 * (e - ta.ema(e, MAPeriod)) + ta.ema(ta.ema(e, MAPeriod), MAPeriod)\n    else if MAType == 'VWMA'\n        ta.vwma(MASource, MAPeriod)\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * Number strategies\n// *************************************************************************************************************************************************************************************************************************************************************************\nn_strategies() =>\n    var result = 0.\n    if str_1\n        result := 1.\n    if str_2\n        result += 1.\n    if str_3\n        result += 1.\n    if str_4\n        result += 1.\n    if str_5\n        result += 1.\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * Price take profit\n// *************************************************************************************************************************************************************************************************************************************************************************\nprice_takeProfit(percentage, N) =>\n    if strategy.position_size > 0\n        strategy.position_avg_price * (1 + N * percentage)\n    else\n        strategy.position_avg_price * (1 - N * percentage)\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * Weigthed values\n// *************************************************************************************************************************************************************************************************************************************************************************\nweight_values(signal) =>\n    if signal\n        weight = 1.0\n    else\n        weight = 0.\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * Weigthed total\n// *************************************************************************************************************************************************************************************************************************************************************************\nweight_total(signal1, signal2, signal3, signal4, signal5) =>\n    weight_str1 * weight_values(signal1) + weight_str2 * weight_values(signal2) + weight_str3 * weight_values(signal3) + weight_str4 * weight_values(signal4) + weight_str5 * weight_values(signal5)\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * Set alert TP message\n// *************************************************************************************************************************************************************************************************************************************************************************\nset_alarm_label_TP() =>\n    if strategy.position_size > 0\n        alarm_label_TP_long\n    else if strategy.position_size < 0\n        alarm_label_TP_short \n// *************************************************************************************************************************************************************************************************************************************************************************\n// * Color\n// *************************************************************************************************************************************************************************************************************************************************************************\ncolors(type, value=0) =>\n    switch str.lower(type)\n        'buy'=> color.new(color.aqua, value)\n        'sell' => color.new(color.gray, value)\n        'TP' => color.new(color.aqua, value)\n        'SL' => color.new(color.gray, value)\n        'signal' => color.new(color.orange, value)\n        'profit' => color.new(color.teal, value)\n        'loss' => color.new(color.red, value)\n        'info' => color.new(color.white, value)\n        'highlights' => color.new(color.orange, value)\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * Bar since last entry\n// *************************************************************************************************************************************************************************************************************************************************************************\nbars_since_entry() =>\n    bar_index - strategy.opentrades.entry_bar_index(0)\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * Bar since close or TP/STOP\n// *************************************************************************************************************************************************************************************************************************************************************************\nbars_since_close() =>\n    ta.barssince(ta.change(strategy.closedtrades))\n// *************************************************************************************************************************************************************************************************************************************************************************\n// ADDITIONAL GLOBAL VARIABLES\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * Compute time since last entry and last close/TP position\nsince_entry := bars_since_entry()\nsince_close := bars_since_close()\nif strategy.opentrades == 0\n    since_entry := delay_exit\nif strategy.closedtrades == 0\n    since_close := delay_exit\n// *************************************************************************************************************************************************************************************************************************************************************************\n// STRATEGIES\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * STRATEGY 1: MACD\n// *************************************************************************************************************************************************************************************************************************************************************************\nMA1 = ma(MA1_type_1, MA1_source_1, MA1_period_1)\nMA2 = ma(MA2_type_1, MA2_source_1, MA2_period_1)\n\nMACD = MA1 - MA2\nsignal = ma('SMA', MACD, 9)\ntrend= MACD - signal\n\nlong = MACD > signal\nshort = MACD < signal\nproportion = math.abs(MACD / signal)\n\n// * Conditions\nlong_signal1 = long and long[delay_macd - 1] and not long[delay_macd]\nshort_signal1 = short and short[delay_macd - 1] and not short[delay_macd]\nclose_long1 = short and not long[delay_macd]\nclose_short1 = long and not short[delay_macd]\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * STRATEGY 2: STOCH RSI\n// *************************************************************************************************************************************************************************************************************************************************************************\nrsi = ta.rsi(close, length_RSI)\nsrsi = ta.stoch(rsi, rsi, rsi, length_stoch)\nk = ma('SMA', srsi, smoothK)\nisRsiOB = k >= long_RSI\nisRsiOS = k <= short_RSI\n\n// * Conditions\nlong_signal2 = isRsiOS[delay_srsi] and not isRsiOB and since_entry >= delay_exit and since_close >= delay_exit\nshort_signal2 = isRsiOB[delay_srsi] and not isRsiOS and since_entry >= delay_exit and since_close >= delay_exit\nclose_long2 = short_signal2\nclose_short2 = long_signal2\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * STRATEGY 3: RSI\n// *************************************************************************************************************************************************************************************************************************************************************************\nisRsiOB2 = rsi >= long_RSI2\nisRsiOS2 = rsi <= short_RSI2\n\n// * Conditions\nlong_signal3 = isRsiOS2[delay_rsi] and not isRsiOB2 and since_entry >= delay_exit and since_close >= delay_exit\nshort_signal3 = isRsiOB2[delay_rsi] and not isRsiOS2 and since_entry >= delay_exit and since_close >= delay_exit\nclose_long3 = short_signal3\nclose_short3 = long_signal3\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * STRATEGY 4: SUPERTREND\n// *************************************************************************************************************************************************************************************************************************************************************************\natr2 = ma('SMA', ta.tr, periods_4)\natr = change_ATR ? ta.atr(periods_4) : atr2\nup = source_4 - multiplier * atr\nup1 = nz(up[1], up)\nup := close[1] > up1 ? math.max(up, up1) : up\n\ndn = source_4 + multiplier * atr\ndn1 = nz(dn[1], dn)\ndn := close[1] < dn1 ? math.min(dn, dn1) : dn\n\ntrend := 1\ntrend := nz(trend[1], trend)\ntrend := trend == -1 and close > dn1 ? 1 : trend == 1 and close < up1 ? -1 : trend\n\n// * Conditions\nlong4 = trend == 1\nshort4 = trend == -1\nlong_signal4 = trend == 1 and trend[delay_super - 1] == 1 and trend[delay_super] == -1\nshort_signal4 = trend == -1 and trend[delay_super - 1] == -1 and trend[delay_super] == 1\nchangeCond = trend != trend[1]\nclose_long4 = short_signal4\nclose_short4 = short_signal4\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * STRATEGY 5: MA CROSS\n// *************************************************************************************************************************************************************************************************************************************************************************\nMA12 = ma(MA1_type_5, MA1_source_5, MA1_period_5)\nMA22 = ma(MA2_type_5, MA2_source_5, MA2_period_5)\n\nlong5 = MA12 > MA22\nshort5 = MA12 < MA22\n\n// * Conditions\nlong_signal5 = long5 and long5[delay_cross - 1] and not long5[delay_cross]\nshort_signal5 = short5 and short5[delay_cross - 1] and not short5[delay_cross]\nclose_long5 = short5 and not long5[delay_cross]\nclose_short5 = long5 and not short5[delay_cross]\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * STRATEGY 6: POTENTIAL TOP/BOTTOM\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * Combination RSI, Stoch RSI, MACD, volume, and weighted-strategy to detect potential TOP/BOTTOMS areas\nvolumeRSI_condition = volume[2] > volume[3] and volume[2] > volume[4] and volume[2] > volume[5]\ncondition_OB1 = isRsiOB2 and (isRsiOB or volume < ma('SMA', volume, 20) / 2) and volumeRSI_condition\ncondition_OS1 = isRsiOS2 and (isRsiOS or volume < ma('SMA', volume, 20) / 2) and volumeRSI_condition\n\ncondition_OB2 = volume[2] / volume[1] > (1.0 + long_trail_perc) and isRsiOB and volumeRSI_condition\ncondition_OS2 = volume[2] / volume[1] > (1.0 + short_trail_perc) and isRsiOS and volumeRSI_condition\n\ncondition_OB3 = weight_total(MACD < signal, isRsiOB, isRsiOB2, short4, short5) >= weight_trigger\ncondition_OS3 = weight_total(MACD > signal, isRsiOS, isRsiOS2, long4, long5) >= weight_trigger\n\ncondition_OB = (condition_OB1 or condition_OB2)\ncondition_OS = (condition_OS1 or condition_OS2)\ncondition_OB_several = condition_OB[1] and condition_OB[2] or condition_OB[1] and condition_OB[3] or condition_OB[1] and condition_OB[4] or condition_OB[1] and condition_OB[5] or condition_OB[1] and condition_OB[6] or condition_OB[1] and condition_OB[7] \ncondition_OS_several = condition_OS[1] and condition_OS[2] or condition_OS[1] and condition_OS[3] or condition_OS[1] and condition_OS[4] or condition_OS[1] and condition_OS[5] or condition_OS[1] and condition_OS[6] or condition_OS[1] and condition_OS[7] \n// *************************************************************************************************************************************************************************************************************************************************************************\n// STRATEGY ENTRIES AND EXITS\n// *************************************************************************************************************************************************************************************************************************************************************************\nif time >= start and time <= end and FLAG_VISIBLE\n    // ***************************************************************************************************************************************************************************\n    // * Set Entries\n    // ***************************************************************************************************************************************************************************\n    if str_0\n        if not str_1\n            weight_str1 := 0\n        if not str_2\n            weight_str2 := 0\n        if not str_3\n            weight_str3 := 0\n        if not str_4\n            weight_str4 := 0\n        if not str_5\n            weight_str5 := 0\n        if allow_shorts == true\n            w_total = weight_total(short_signal1, short_signal2, short_signal3, short_signal4, short_signal5)\n            if w_total >= weight_trigger\n                strategy.entry('Short', strategy.short, alert_message=alarm_label_short)\n        if allow_longs == true\n            w_total = weight_total(long_signal1, long_signal2, long_signal3, long_signal4, long_signal5)\n            if w_total >= weight_trigger\n                strategy.entry('Long', strategy.long, alert_message=alarm_label_long)\n    else\n        if allow_shorts == true\n            if str_1\n                strategy.entry('Short', strategy.short, when=short_signal1, alert_message=alarm_label_short)\n            if str_2\n                strategy.entry('Short', strategy.short, when=short_signal2, alert_message=alarm_label_short)\n            if str_3\n                strategy.entry('Short', strategy.short, when=short_signal3, alert_message=alarm_label_short)\n            if str_4\n                strategy.entry('Short', strategy.short, when=short_signal4, alert_message=alarm_label_short)\n            if str_5\n                strategy.entry('Short', strategy.short, when=short_signal5, alert_message=alarm_label_short)\n        if allow_longs == true\n            if str_1\n                strategy.entry('Long', strategy.long, when=long_signal1, alert_message=alarm_label_long)\n            if str_2\n                strategy.entry('Long', strategy.long, when=long_signal2, alert_message=alarm_label_long)\n            if str_3\n                strategy.entry('Long', strategy.long, when=long_signal3, alert_message=alarm_label_long)\n            if str_4\n                strategy.entry('Long', strategy.long, when=long_signal4, alert_message=alarm_label_long)\n            if str_5\n                strategy.entry('Long', strategy.long, when=long_signal5, alert_message=alarm_label_long)\n    // ***************************************************************************************************************************************************************************\n    // * Set Take Profits\n    // ***************************************************************************************************************************************************************************\n    if strategy.position_size != 0 and take_profits and since_entry == 0\n        for i = 1 to MAX_TP\n            id = 'TP ' + str.tostring(i)\n            strategy.exit(id=id, limit=price_takeProfit(profit_perc, i), qty_percent=profit_qty, comment=id, alert_message=set_alarm_label_TP())\n    // ***************************************************************************************************************************************************************************\n    // * Set Stop loss\n    // ***************************************************************************************************************************************************************************\n    if strategy.position_size > 0\n        if since_close == 0\n            if high > price_takeProfit(profit_perc, 6) and MAX_TP >= 6\n                n = 6\n                nextTP := na\n                if movestoploss == 'Percentage'\n                    price_stop_long := strategy.position_avg_price * (1 + n*profit_perc - stoploss_perc * move_stoploss_factor)\n                else if movestoploss == 'TP-1'\n                    price_stop_long := price_takeProfit(profit_perc, n-1)\n                else if movestoploss == 'TP-2'\n                    price_stop_long := price_takeProfit(profit_perc, n-2)\n                else if movestoploss == 'TP-3'\n                    price_stop_long := price_takeProfit(profit_perc, n-3)\n            else if high > price_takeProfit(profit_perc, 5) and MAX_TP >= 5\n                n = 5\n                nextTP := price_takeProfit(profit_perc, n + 1)\n                if movestoploss == 'Percentage'\n                    price_stop_long := strategy.position_avg_price * (1 + n*profit_perc - stoploss_perc * move_stoploss_factor)\n                else if movestoploss == 'TP-1'\n                    price_stop_long := price_takeProfit(profit_perc, n-1)\n                else if movestoploss == 'TP-2'\n                    price_stop_long := price_takeProfit(profit_perc, n-2)\n                else if movestoploss == 'TP-3'\n                    price_stop_long := price_takeProfit(profit_perc, n-3)\n            else if high > price_takeProfit(profit_perc, 4) and MAX_TP >= 4\n                n = 4\n                nextTP := price_takeProfit(profit_perc, n + 1)\n                if movestoploss == 'Percentage'\n                    price_stop_long := strategy.position_avg_price * (1 + n*profit_perc - stoploss_perc * move_stoploss_factor)\n                else if movestoploss == 'TP-1'\n                    price_stop_long := price_takeProfit(profit_perc, n-1)\n                else if movestoploss == 'TP-2'\n                    price_stop_long := price_takeProfit(profit_perc, n-2)\n                else if movestoploss == 'TP-3'\n                    price_stop_long := price_takeProfit(profit_perc, n-3)\n            else if high > price_takeProfit(profit_perc, 3) and MAX_TP >= 3\n                n = 3\n                nextTP := price_takeProfit(profit_perc, n + 1)\n                if movestoploss == 'Percentage'\n                    price_stop_long := strategy.position_avg_price * (1 + n*profit_perc - stoploss_perc * move_stoploss_factor)\n                else if movestoploss == 'TP-1'\n                    price_stop_long := price_takeProfit(profit_perc, n-1)\n                else if movestoploss == 'TP-2'\n                    price_stop_long := price_takeProfit(profit_perc, n-2)\n                else if movestoploss == 'TP-3' and movestoploss_entry\n                    price_stop_long := strategy.position_avg_price\n            else if high > price_takeProfit(profit_perc, 2) and MAX_TP >= 2\n                n = 2\n                nextTP := price_takeProfit(profit_perc, n + 1)\n                if movestoploss == 'Percentage'\n                    price_stop_long := strategy.position_avg_price * (1 + n*profit_perc - stoploss_perc * move_stoploss_factor)\n                else if movestoploss == 'TP-1'\n                    price_stop_long := price_takeProfit(profit_perc, n-1)\n                else if movestoploss == 'TP-2' and movestoploss_entry\n                    price_stop_long := strategy.position_avg_price\n                else if movestoploss == 'TP-3' and movestoploss_entry\n                    price_stop_long := strategy.position_avg_price\n            else if high > price_takeProfit(profit_perc, 1) and MAX_TP >= 1\n                n = 1\n                nextTP := price_takeProfit(profit_perc, n + 1)\n                if movestoploss == 'Percentage'\n                    price_stop_long := strategy.position_avg_price * (1 + n*profit_perc - stoploss_perc * move_stoploss_factor)\n                else if movestoploss == 'TP-1' and movestoploss_entry\n                    price_stop_long := strategy.position_avg_price\n                else if movestoploss == 'TP-2' and movestoploss_entry\n                    price_stop_long := strategy.position_avg_price\n                else if movestoploss == 'TP-3' and movestoploss_entry\n                    price_stop_long := strategy.position_avg_price\n        if since_entry == 0\n            n = 0\n            nextTP := price_takeProfit(profit_perc, n + 1)\n            price_stop_long := strategy.position_avg_price * (1 - stoploss_perc) \n    if strategy.position_size < 0\n        if since_close == 0\n            if low < price_takeProfit(profit_perc, 6) and MAX_TP >= 6\n                n = 6\n                nextTP := na\n                if movestoploss == 'Percentage'\n                    price_stop_short := strategy.position_avg_price * (1 - n*profit_perc + stoploss_perc * move_stoploss_factor)\n                else if movestoploss == 'TP-1'\n                    price_stop_short := price_takeProfit(profit_perc, n-1)\n                else if movestoploss == 'TP-2'\n                    price_stop_short := price_takeProfit(profit_perc, n-2)\n                else if movestoploss == 'TP-3'\n                    price_stop_short := price_takeProfit(profit_perc, n-3)\n            else if low < price_takeProfit(profit_perc, 5) and MAX_TP >= 5\n                n = 5\n                nextTP := price_takeProfit(profit_perc, n + 1)\n                if movestoploss == 'Percentage'\n                    price_stop_short := strategy.position_avg_price * (1 - n*profit_perc + stoploss_perc * move_stoploss_factor)\n                else if movestoploss == 'TP-1'\n                    price_stop_short := price_takeProfit(profit_perc, n-1)\n                else if movestoploss == 'TP-2'\n                    price_stop_short := price_takeProfit(profit_perc, n-2)\n                else if movestoploss == 'TP-3'\n                    price_stop_short := price_takeProfit(profit_perc, n-3)\n            else if low < price_takeProfit(profit_perc, 4) and MAX_TP >= 4\n                n = 4\n                nextTP := price_takeProfit(profit_perc, n + 1)\n                if movestoploss == 'Percentage'\n                    price_stop_short := strategy.position_avg_price * (1 - n*profit_perc + stoploss_perc * move_stoploss_factor)\n                else if movestoploss == 'TP-1'\n                    price_stop_short := price_takeProfit(profit_perc, n-1)\n                else if movestoploss == 'TP-2'\n                    price_stop_short := price_takeProfit(profit_perc, n-2)\n                else if movestoploss == 'TP-3'\n                    price_stop_short := price_takeProfit(profit_perc, n-3)\n            else if low < price_takeProfit(profit_perc, 3) and MAX_TP >= 3\n                n = 3\n                nextTP := price_takeProfit(profit_perc, n + 1)\n                if movestoploss == 'Percentage'\n                    price_stop_short := strategy.position_avg_price * (1 - n*profit_perc + stoploss_perc * move_stoploss_factor)\n                else if movestoploss == 'TP-1'\n                    price_stop_short := price_takeProfit(profit_perc, n-1)\n                else if movestoploss == 'TP-2'\n                    price_stop_short := price_takeProfit(profit_perc, n-2)\n                else if movestoploss == 'TP-3' and movestoploss_entry\n                    price_stop_short := strategy.position_avg_price\n            else if low < price_takeProfit(profit_perc, 2) and MAX_TP >= 2\n                n = 2\n                nextTP := price_takeProfit(profit_perc, n + 1)\n                if movestoploss == 'Percentage'\n                    price_stop_short := strategy.position_avg_price * (1 - n*profit_perc + stoploss_perc * move_stoploss_factor)\n                else if movestoploss == 'TP-1'\n                    price_stop_short := price_takeProfit(profit_perc, n-1)\n                else if movestoploss == 'TP-2' and movestoploss_entry\n                    price_stop_short := strategy.position_avg_price\n                else if movestoploss == 'TP-3' and movestoploss_entry\n                    price_stop_short := strategy.position_avg_price\n            else if low < price_takeProfit(profit_perc, 1) and MAX_TP >= 1\n                n = 1 \n                nextTP := price_takeProfit(profit_perc, n + 1)\n                if movestoploss == 'Percentage'\n                    price_stop_short := strategy.position_avg_price * (1 - n*profit_perc + stoploss_perc * move_stoploss_factor)\n                else if movestoploss == 'TP-1' and movestoploss_entry\n                    price_stop_short := strategy.position_avg_price\n                else if movestoploss == 'TP-2' and movestoploss_entry\n                    price_stop_short := strategy.position_avg_price\n                else if movestoploss == 'TP-3' and movestoploss_entry\n                    price_stop_short := strategy.position_avg_price\n        if since_entry == 0\n            n = 0\n            nextTP := price_takeProfit(profit_perc, n + 1)\n            price_stop_short := strategy.position_avg_price * (1 + stoploss_perc)\n    // ***************************************************************************************************************************************************************************\n    // * Set Exits\n    // ***************************************************************************************************************************************************************************\n    if allow_longs == true and allow_shorts == false\n        if str_0\n            w_total = weight_total(short_signal1, short_signal2, short_signal3, short_signal4, short_signal5)\n            strategy.close('Long', when=w_total>=weight_trigger, qty_percent=100, comment='SHORT', alert_message=alarm_label_close_long)\n        else\n            if str_1\n                strategy.close('Long', when=close_long1, qty_percent=100, comment='SHORT', alert_message=alarm_label_close_long)\n            if str_2\n                strategy.close('Long', when=close_long2, qty_percent=100, comment='SHORT', alert_message=alarm_label_close_long)\n            if str_3\n                strategy.close('Long', when=close_long3, qty_percent=100, comment='SHORT', alert_message=alarm_label_close_long)\n            if str_4\n                strategy.close('Long', when=close_long4, qty_percent=100, comment='SHORT', alert_message=alarm_label_close_long)\n            if str_5\n                strategy.close('Long', when=close_long5, qty_percent=100, comment='SHORT', alert_message=alarm_label_close_long)\n    if allow_longs == false and allow_shorts == true\n        if str_0\n            w_total = weight_total(long_signal1, long_signal2, long_signal3, long_signal4, long_signal5)\n            strategy.close('Short', when=w_total>=weight_trigger, qty_percent=100, comment='LONG', alert_message=alarm_label_close_short)\n        else\n            if str_1\n                strategy.close('Short', when=close_long1, qty_percent=100, comment='LONG', alert_message=alarm_label_close_short)\n            if str_2\n                strategy.close('Short', when=close_long2, qty_percent=100, comment='LONG', alert_message=alarm_label_close_short)\n            if str_3\n                strategy.close('Short', when=close_long3, qty_percent=100, comment='LONG', alert_message=alarm_label_close_short)\n            if str_4\n                strategy.close('Short', when=close_long4, qty_percent=100, comment='LONG', alert_message=alarm_label_close_short)\n            if str_5\n                strategy.close('Short', when=close_long5, qty_percent=100, comment='LONG', alert_message=alarm_label_close_short)\n    if allow_shorts == true and strategy.position_size < 0 and stoploss and since_entry > 0\n        strategy.close('Short', when=stop_source >= price_stop_short, qty_percent=100, comment='STOP', alert_message=alarm_label_SL)\n        if str_6\n            if top_qty == 100\n                strategy.close('Short', when=condition_OS_several, qty_percent=bottom_qty, comment='STOP', alert_message=alarm_label_SL)\n            else    \n                strategy.exit('Short', when=condition_OS_several, limit=source_6_bottom[1], qty_percent=bottom_qty, comment='TP-B', alert_message=set_alarm_label_TP())\n    if allow_longs == true and strategy.position_size > 0 and stoploss and since_entry > 0\n        strategy.close('Long', when=stop_source <= price_stop_long, qty_percent=100, comment='STOP', alert_message=alarm_label_SL)\n        if str_6\n            if top_qty == 100\n                strategy.close('Long', when=condition_OB_several, qty_percent=top_qty, comment='STOP', alert_message=alarm_label_SL)\n            else\n                strategy.exit('Long', when=condition_OB_several, limit=source_6_top[1], qty_percent=top_qty, comment='TP-T', alert_message=set_alarm_label_TP())\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * Data window - debugging\n// *************************************************************************************************************************************************************************************************************************************************************************\nprice_stop = strategy.position_size > 0 ? price_stop_long : price_stop_short\n\nplotchar(volume[2] / volume[1], \"Volume 2 / Volume 1\", \"\", location.top, size = size.tiny, color=color.new(color.orange, 0))\nplotchar(since_entry, \"Since entry [bars]\", \"\", location.top, size = size.tiny, color=color.new(color.orange, 0))\nplotchar(since_close, \"Since close/TP [bars]\", \"\", location.top, size = size.tiny, color=color.new(color.orange, 0))\nplotchar(strategy.position_avg_price, \"Average position price\", \"\", location.top, size = size.tiny, color=color.new(color.orange, 0))\nplotchar(strategy.position_size, \"Position size\", \"\", location.top, size = size.tiny, color=color.new(color.orange, 0))\nplotchar(nextTP, \"Next TP target\", \"\", location.top, size = size.tiny, color=color.new(color.teal, 0))\nplotchar(price_stop, \"STOP Price\", \"\", location.top, size = size.tiny, color=color.new(color.gray, 0))\nplotchar(strategy.opentrades, \"Open trades\", \"\", location.top, size = size.tiny, color=strategy.position_size > 0 ? color.blue : color.gray)\nplotchar(strategy.netprofit, \"Net profit [$]\", \"\", location.top, size = size.tiny, color=strategy.netprofit > 0 ? color.blue : color.gray)\nplotchar(strategy.grossprofit, \"Gross profit [$]\", \"\", location.top, size = size.tiny, color=color.blue) \nplotchar(strategy.grossloss, \"Gross loss [$]\", \"\", location.top, size = size.tiny, color=color.gray) \nplotchar(strategy.openprofit, \"Unrealized P&L [$]\", \"\", location.top, size = size.tiny, color=strategy.openprofit > 0 ? color.blue : color.gray)\nplotchar(strategy.closedtrades, \"Closed trades\", \"\", location.top, size = size.tiny, color=color.orange) \nplotchar(strategy.wintrades/strategy.closedtrades*100, \"Winrate [%]\", \"\", location.top, size = size.tiny, color=strategy.wintrades/strategy.closedtrades > 60 ? color.blue : color.gray) \n// *************************************************************************************************************************************************************************************************************************************************************************\n// PLOTS\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * strategy 1: MACD\n// *************************************************************************************************************************************************************************************************************************************************************************\nplot(FLAG_VISIBLE ? trend:na, 'Trend', style=plot.style_columns, color=MACD > signal ? color.new(color.teal, 30) : color.new(color.gray, 30), display=display.none)\nplot(FLAG_VISIBLE ? MACD:na, 'MACD', color=color.new(color.blue, 0), display=display.none)\nplot(FLAG_VISIBLE ? signal:na, 'Signal', color=color.new(color.orange, 0), display=display.none)\nplotshape(long_signal1 and FLAG_SIGNALS and FLAG_VISIBLE ? up : na, 'Buy MACD', text='MACD', location=location.absolute, style=shape.labelup, size=size.tiny, color=color.new(color.teal, 0), textcolor=color.new(color.white, 0), display=display.none)\nplotshape(short_signal1 and FLAG_SIGNALS and FLAG_VISIBLE ? dn : na, 'Sell MACD', text='MACD', location=location.absolute, style=shape.labeldown, size=size.tiny, color=color.new(color.gray, 0), textcolor=color.new(color.white, 0), display=display.none)\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * strategy 2: Stoch RSI\n// *************************************************************************************************************************************************************************************************************************************************************************\nplotshape(long_signal2 and FLAG_SIGNALS and FLAG_VISIBLE ? up : na, title='Buy Stoch RSI', text='SRSI', location=location.absolute, style=shape.labelup, size=size.tiny, color=color.new(color.teal, 0), textcolor=color.new(color.white, 0), display=display.none)\nplotshape(short_signal2 and FLAG_SIGNALS and FLAG_VISIBLE ? dn : na, title='Sell Stoch RSI', text='SRSI', location=location.absolute, style=shape.labeldown, size=size.tiny, color=color.new(color.gray, 0), textcolor=color.new(color.white, 0), display=display.none)\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * strategy 3: RSI\n// *************************************************************************************************************************************************************************************************************************************************************************\nplotshape(long_signal3 and FLAG_SIGNALS and FLAG_VISIBLE ? up : na, title='Buy RSI', text='RSI', location=location.absolute, style=shape.labelup, size=size.tiny, color=color.new(color.teal, 0), textcolor=color.new(color.white, 0), display=display.none)\nplotshape(short_signal3 and FLAG_SIGNALS and FLAG_VISIBLE ? dn : na, title='Sell RSI', text='RSI', location=location.absolute, style=shape.labeldown, size=size.tiny, color=color.new(color.gray, 0), textcolor=color.new(color.white, 0), display=display.none)\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * strategy 4: Supertrend\n// *************************************************************************************************************************************************************************************************************************************************************************\nplotshape(long_signal4 and FLAG_SIGNALS and FLAG_VISIBLE ? up : na, title='Buy Supertrend', text='Supertrend', location=location.absolute, style=shape.labelup, size=size.tiny, color=color.new(color.teal, 0), textcolor=color.new(color.white, 0), display=display.none)\nplotshape(short_signal4 and FLAG_SIGNALS and FLAG_VISIBLE ? dn : na, title='Sell Supertrend', text='Supertrend', location=location.absolute, style=shape.labeldown, size=size.tiny, color=color.new(color.gray, 0), textcolor=color.new(color.white, 0), display=display.none)\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * strategy 5: MA CROSS\n// *************************************************************************************************************************************************************************************************************************************************************************\nplotshape(long_signal5 and FLAG_SIGNALS and FLAG_VISIBLE ? up : na, title='Buy MA CROSS', text='MA CROSS', location=location.absolute, style=shape.labelup, size=size.tiny, color=color.new(color.teal, 0), textcolor=color.new(color.white, 0), display=display.none)\nplotshape(short_signal5 and FLAG_SIGNALS and FLAG_VISIBLE ? dn : na, title='Sell MA CROSS', text='MA CROSS', location=location.absolute, style=shape.labeldown, size=size.tiny, color=color.new(color.gray, 0), textcolor=color.new(color.white, 0), display=display.none)\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * STRATEGY 6: POTENTIAL TOP/BOTTOM\n// *************************************************************************************************************************************************************************************************************************************************************************\nplotshape(condition_OB_several and FLAG_VISIBLE ? dn : na, title='Top', text='T', location=location.abovebar, style=shape.labeldown, size=size.tiny, color=color.new(color.teal, 0), textcolor=color.new(color.white, 0))\nplotshape(condition_OS_several and FLAG_VISIBLE ? up : na, title='Bottom', text='B', location=location.belowbar, style=shape.labelup, size=size.tiny, color=color.new(color.teal, 0), textcolor=color.new(color.white, 0))\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * Buy/Sell signals\n// *************************************************************************************************************************************************************************************************************************************************************************\nw_total_long = weight_total(long_signal1, long_signal2, long_signal3, long_signal4, long_signal5)\nw_total_short = weight_total(short_signal1, short_signal2, short_signal3, short_signal4, short_signal5)\nplotshape(w_total_long >= weight_trigger and FLAG_SIGNALS and FLAG_VISIBLE ? up : na, title='Buy Weigthed strategy', text='Buy', location=location.absolute, style=shape.labelup, size=size.tiny, color=color.new(color.teal, 0), textcolor=color.new(color.white, 0))\nplotshape(w_total_short >= weight_trigger and FLAG_SIGNALS and FLAG_VISIBLE ? dn : na, title='Sell Weigthed strategy', text='Sell', location=location.absolute, style=shape.labeldown, size=size.tiny, color=color.new(color.gray, 0), textcolor=color.new(color.white, 0))\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * Stop loss targets\n// *************************************************************************************************************************************************************************************************************************************************************************\nplot(series=(strategy.position_size > 0) and FLAG_VISIBLE ? price_stop_long : na, color=color.new(color.gray, 30), style=plot.style_cross, linewidth=2, title=\"Long Stop Loss\")\nplot(series=(strategy.position_size < 0) and FLAG_VISIBLE ? price_stop_short : na, color=color.new(color.gray, 30), style=plot.style_cross, linewidth=2, title=\"Short Stop Loss\")\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * TP targets\n// *************************************************************************************************************************************************************************************************************************************************************************\nplot(strategy.position_size > 0 or strategy.position_size < 0 and FLAG_VISIBLE ? nextTP : na, color=color.new(color.aqua, 30), style=plot.style_cross, linewidth=2, title=\"Next TP\")\n// *************************************************************************************************************************************************************************************************************************************************************************\n// * All strategies\n// *************************************************************************************************************************************************************************************************************************************************************************\nmPlot = plot(FLAG_VISIBLE ? ohlc4:na, title='Price ohlc4', style=plot.style_circles, linewidth=0, display=display.none)\nupPlot = plot((long_signal1 or long_signal2 or long_signal3 or long_signal4 or long_signal5) and (w_total_long > w_total_short) and FLAG_VISIBLE ? up : na, title='Up Trend', style=plot.style_linebr, linewidth=2, color=color.new(color.aqua, 0), display=display.none)\ndnPlot = plot((short_signal1 or short_signal2 or short_signal3 or short_signal4 or short_signal5) and (w_total_short > w_total_long) and FLAG_VISIBLE ? dn : na, title='Down Trend', style=plot.style_linebr, linewidth=2, color=color.new(color.gray, 0), display=display.none)\nplotchar(FLAG_VISIBLE ? weight_trigger:na, \"Trigger strategies\", \"\", location.top, size = size.tiny, color=color.new(color.orange, 0))\nplotchar(FLAG_VISIBLE ? w_total_long:na, \"Satisfied Long strategies\", \"\", location.top, size = size.tiny, color=w_total_long >= weight_trigger ? color.orange : color.gray)\nplotchar(FLAG_VISIBLE ? w_total_short:na, \"Satisfied Short strategies\", \"\", location.top, size = size.tiny, color=w_total_long >= weight_trigger ? color.orange : color.gray)\nplotshape((long_signal1 or long_signal2 or long_signal3 or long_signal4 or long_signal5) and (w_total_long > w_total_short) and FLAG_VISIBLE ? up : na, title='UpTrend Begins', location=location.absolute, style=shape.circle, size=size.tiny, color=color.new(color.aqua, 0), display=display.none)\nplotshape((short_signal1 or short_signal2 or short_signal3 or short_signal4 or short_signal5) and (w_total_short > w_total_long) and FLAG_VISIBLE ? dn : na, title='DownTrend Begins', location=location.absolute, style=shape.circle, size=size.tiny, color=color.new(color.gray, 0), display=display.none)\nfill(mPlot, upPlot, title='UpTrend Highligter', color=colors('buy', FLAG_SHADOWS and FLAG_VISIBLE ? 80:100))\nfill(mPlot, dnPlot, title='DownTrend Highligter', color=colors('sell', FLAG_SHADOWS and FLAG_VISIBLE ? 80:100))\n// *************************************************************************************************************************************************************************************************************************************************************************\n// MONTHLY TABLE PERFORMANCE - Developed by @QuantNomad\n// *************************************************************************************************************************************************************************************************************************************************************************\nshow_performance = input.bool(true, 'Show Monthly Performance ?', group='Performance - credits: @QuantNomad')\nprec = input(2, 'Return Precision', group='Performance - credits: @QuantNomad')\n\nif show_performance and FLAG_VISIBLE\n    new_month = month(time) != month(time[1])\n    new_year  = year(time)  != year(time[1])\n    \n    eq = strategy.equity\n    \n    bar_pnl = eq / eq[1] - 1\n    \n    cur_month_pnl = 0.0\n    cur_year_pnl  = 0.0\n    \n    // Current Monthly P&L\n    cur_month_pnl := new_month ? 0.0 : \n                     (1 + cur_month_pnl[1]) * (1 + bar_pnl) - 1 \n    \n    // Current Yearly P&L\n    cur_year_pnl := new_year ? 0.0 : \n                     (1 + cur_year_pnl[1]) * (1 + bar_pnl) - 1  \n    \n    // Arrays to store Yearly and Monthly P&Ls\n    var month_pnl  = array.new_float(0)\n    var month_time = array.new_int(0)\n    \n    var year_pnl  = array.new_float(0)\n    var year_time = array.new_int(0)\n    \n    last_computed = false\n    \n    if (not na(cur_month_pnl[1]) and (new_month or barstate.islastconfirmedhistory))\n        if (last_computed[1])\n            array.pop(month_pnl)\n            array.pop(month_time)\n            \n        array.push(month_pnl , cur_month_pnl[1])\n        array.push(month_time, time[1])\n    \n    if (not na(cur_year_pnl[1]) and (new_year or barstate.islastconfirmedhistory))\n        if (last_computed[1])\n            array.pop(year_pnl)\n            array.pop(year_time)\n            \n        array.push(year_pnl , cur_year_pnl[1])\n        array.push(year_time, time[1])\n    \n    last_computed := barstate.islastconfirmedhistory ? true : nz(last_computed[1])\n    \n    // Monthly P&L Table    \n    var monthly_table = table(na)\n    \n    if (barstate.islastconfirmedhistory)\n        monthly_table := table.new(position.bottom_right, columns = 14, rows = array.size(year_pnl) + 1, border_width = 1)\n    \n        table.cell(monthly_table, 0,  0, \"\",     bgcolor = #cccccc)\n        table.cell(monthly_table, 1,  0, \"Jan\",  bgcolor = #cccccc)\n        table.cell(monthly_table, 2,  0, \"Feb\",  bgcolor = #cccccc)\n        table.cell(monthly_table, 3,  0, \"Mar\",  bgcolor = #cccccc)\n        table.cell(monthly_table, 4,  0, \"Apr\",  bgcolor = #cccccc)\n        table.cell(monthly_table, 5,  0, \"May\",  bgcolor = #cccccc)\n        table.cell(monthly_table, 6,  0, \"Jun\",  bgcolor = #cccccc)\n        table.cell(monthly_table, 7,  0, \"Jul\",  bgcolor = #cccccc)\n        table.cell(monthly_table, 8,  0, \"Aug\",  bgcolor = #cccccc)\n        table.cell(monthly_table, 9,  0, \"Sep\",  bgcolor = #cccccc)\n        table.cell(monthly_table, 10, 0, \"Oct\",  bgcolor = #cccccc)\n        table.cell(monthly_table, 11, 0, \"Nov\",  bgcolor = #cccccc)\n        table.cell(monthly_table, 12, 0, \"Dec\",  bgcolor = #cccccc)\n        table.cell(monthly_table, 13, 0, \"Year\", bgcolor = #999999)\n    \n    \n        for yi = 0 to array.size(year_pnl) - 1\n            table.cell(monthly_table, 0,  yi + 1, str.tostring(year(array.get(year_time, yi))), bgcolor = #cccccc)\n            \n            y_color = array.get(year_pnl, yi) > 0 ? color.new(color.teal, transp = 40) : color.new(color.gray, transp = 40)\n            table.cell(monthly_table, 13, yi + 1, str.tostring(math.round(array.get(year_pnl, yi) * 100, prec)), bgcolor = y_color, text_color=color.new(color.white, 0))\n            \n        for mi = 0 to array.size(month_time) - 1\n            m_row   = year(array.get(month_time, mi))  - year(array.get(year_time, 0)) + 1\n            m_col   = month(array.get(month_time, mi)) \n            m_color = array.get(month_pnl, mi) > 0 ? color.new(color.teal, transp = 40) : color.new(color.gray, transp = 40)\n            \n            table.cell(monthly_table, m_col, m_row, str.tostring(math.round(array.get(month_pnl, mi) * 100, prec)), bgcolor = m_color, text_color=color.new(color.white, 0))",
  "name": "algo"
}